# Reference: https://cmkr.build/cmake-toml
[cmake]
version = "4.0.0"
cmkr-include = "cmkr.cmake"

[project]
name = "SaveManager"
description = "The definitive local save manager"
languages = ["CXX"]

[variables]
CMAKE_EXPORT_COMPILE_COMMANDS = true

[target.savemanager]
type = "executable"

sources = [
    "src/**.cpp",

    # Dear ImGui
    "external/imgui/imgui.cpp",
    "external/imgui/imgui_draw.cpp",
    "external/imgui/imgui_tables.cpp",
    "external/imgui/imgui_widgets.cpp",
    "external/imgui/backends/imgui_impl_glfw.cpp",
    "external/imgui/backends/imgui_impl_opengl3.cpp",
    "external/imgui/imgui_demo.cpp",
]

include-directories = [
    "external",
    "external/imgui",
    "external/imgui/backends",
    "src",
]

compile-features = ["cxx_std_17"]

link-libraries = [
    "glfw",
    "OpenGL::GL",
    "$<IF:$<BOOL:${VCPKG_TARGET_TRIPLET}>,libzip::zip,$<IF:$<PLATFORM_ID:Darwin>,${LIBZIP_LIBRARIES},zip>>",
    "$<IF:$<BOOL:${VCPKG_TARGET_TRIPLET}>,CURL::libcurl,$<IF:$<PLATFORM_ID:Darwin>,${CURL_LIBRARIES},curl>>",
]

cmake-before = """
find_package(OpenGL REQUIRED)
find_package(glfw3 REQUIRED)

if(DEFINED VCPKG_TARGET_TRIPLET)
    find_package(libzip CONFIG REQUIRED)
    find_package(CURL REQUIRED)
elseif(APPLE)
    if(EXISTS "/opt/homebrew")
        list(APPEND CMAKE_PREFIX_PATH "/opt/homebrew")
    elseif(EXISTS "/usr/local")
        list(APPEND CMAKE_PREFIX_PATH "/usr/local")
    endif()
    find_package(PkgConfig REQUIRED)
    pkg_check_modules(LIBZIP REQUIRED libzip)
    pkg_check_modules(CURL REQUIRED libcurl)
    include_directories(${LIBZIP_INCLUDE_DIRS} ${CURL_INCLUDE_DIRS})
    link_directories(${LIBZIP_LIBRARY_DIRS} ${CURL_LIBRARY_DIRS})
endif()
"""
